<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>MoodRecipe</title>
    <style>
        :root {
            --bg: #f4f7f6;
            --card: #ffffff;
            --text: #222;
            --accent: #6bc4a3;
            --button: #ffb703;
            --button-hover: #fb8500;
            --error: #ff6b6b;
            --success: #4caf50;
            --transition: all 0.3s ease;
        }

        body.dark {
            --bg: #121212;
            --card: #1f1f1f;
            --text: #eaeaea;
            --accent: #3aa88b;
            --button: #ffb703;
            --button-hover: #fb8500;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            transition: var(--transition);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }

        header {
            background: var(--accent);
            color: white;
            padding: 1.2rem 1rem;
            position: relative;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        main {
            flex: 1;
            padding: 0.8rem;
            max-width: 800px;
            margin: 0 auto;
            width: 100%;
        }

        section {
            background: var(--card);
            margin: 1rem 0;
            padding: 1.2rem;
            border-radius: 12px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.08);
        }

        h1, h2, h3 {
            margin-bottom: 0.8rem;
            line-height: 1.3;
        }

        h1 {
            font-size: 1.8rem;
            text-align: center;
        }

        h2 {
            font-size: 1.3rem;
            color: var(--accent);
        }

        h3 {
            font-size: 1.1rem;
        }

        .button-group {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 0.6rem;
            margin: 1rem 0;
        }

        button {
            padding: 0.9rem 1.2rem;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            cursor: pointer;
            background: var(--button);
            color: #222;
            font-weight: 600;
            transition: var(--transition);
            flex: 1 1 calc(50% - 0.6rem);
            min-width: 0;
            min-height: 48px; /* Better touch target */
            touch-action: manipulation;
        }

        button:hover, button:active {
            background: var(--button-hover);
            color: white;
            transform: translateY(-2px);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .card {
            background: var(--card);
            margin: 0.8rem 0;
            padding: 1rem;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.08);
            transition: var(--transition);
            border: 1px solid rgba(0,0,0,0.05);
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.12);
        }

        .card a {
            text-decoration: none;
            color: var(--text);
            font-weight: 600;
            display: block;
            margin-bottom: 0.5rem;
            font-size: 1rem;
            line-height: 1.4;
            padding: 0.2rem 0;
        }

        .allergens {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
            font-size: 0.85rem;
        }

        .allergen-tag {
            background: rgba(255, 107, 107, 0.15);
            padding: 0.4rem 0.7rem;
            border-radius: 15px;
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
            font-size: 0.85rem;
            min-height: 28px;
        }

        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            font-size: 1.1rem;
            color: var(--accent);
            text-align: center;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(107, 196, 163, 0.3);
            border-top: 4px solid var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .filter-section {
            margin: 1.2rem 0;
            padding: 1rem;
            background: rgba(107, 196, 163, 0.1);
            border-radius: 10px;
        }

        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            gap: 0.7rem;
            margin-top: 1rem;
        }

        .filter-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            background: rgba(255,255,255,0.7);
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
        }

        .filter-item:hover {
            background: rgba(255,255,255,0.9);
        }

        .filter-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        footer {
            background: #222;
            color: white;
            padding: 1rem;
            text-align: center;
            margin-top: auto;
            font-size: 0.9rem;
        }

        .toggle {
            position: absolute;
            top: 0.8rem;
            right: 0.8rem;
            background: rgba(255,255,255,0.2);
            color: white;
            padding: 0.5rem 0.8rem;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 0.4rem;
            transition: var(--transition);
            min-height: 36px;
        }

        .toggle:active {
            background: rgba(255,255,255,0.3);
            transform: scale(0.98);
        }

        .status-message {
            padding: 0.8rem;
            border-radius: 8px;
            margin: 1rem 0;
            text-align: center;
            font-size: 0.95rem;
        }

        .success {
            background: rgba(76, 175, 80, 0.15);
            color: var(--success);
            border: 1px solid rgba(76, 175, 80, 0.3);
        }

        .error {
            background: rgba(255, 107, 107, 0.15);
            color: var(--error);
            border: 1px solid rgba(255, 107, 107, 0.3);
        }

        .location-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            text-align: center;
        }

        .mood-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.6rem;
            margin: 1rem 0;
        }

        .mood-buttons button {
            min-height: 60px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 0.3rem;
            font-size: 1rem;
            padding: 0.8rem;
        }

        .mood-buttons button span {
            font-size: 1.5rem;
            margin-bottom: 0.2rem;
        }

        /* Mobile-specific optimizations */
        @media (max-width: 480px) {
            header {
                padding: 1rem 0.8rem;
            }
            
            h1 {
                font-size: 1.6rem;
                padding-right: 80px; /* Make room for dark mode toggle */
            }
            
            h2 {
                font-size: 1.2rem;
            }
            
            main {
                padding: 0.5rem;
            }
            
            section {
                padding: 1rem;
                margin: 0.8rem 0;
            }
            
            .mood-buttons {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }
            
            .mood-buttons button {
                min-height: 55px;
            }
            
            .filter-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.6rem;
            }
            
            .filter-item {
                padding: 0.6rem;
                font-size: 0.9rem;
            }
            
            .filter-item input[type="checkbox"] {
                width: 20px;
                height: 20px;
            }
            
            button {
                padding: 0.9rem;
                font-size: 0.95rem;
                min-height: 44px;
            }
            
            .card {
                padding: 0.9rem;
                margin: 0.6rem 0;
            }
            
            .toggle {
                top: 0.6rem;
                right: 0.6rem;
                padding: 0.4rem 0.7rem;
            }
            
            .status-message {
                padding: 0.7rem;
                font-size: 0.9rem;
            }
            
            .allergen-tag {
                padding: 0.3rem 0.6rem;
                font-size: 0.8rem;
            }
        }

        /* Very small phones */
        @media (max-width: 360px) {
            h1 {
                font-size: 1.4rem;
            }
            
            h2 {
                font-size: 1.1rem;
            }
            
            .filter-grid {
                grid-template-columns: 1fr;
            }
            
            .mood-buttons button {
                font-size: 0.9rem;
                min-height: 50px;
            }
            
            .toggle {
                font-size: 0.8rem;
                padding: 0.3rem 0.6rem;
            }
        }

        /* Prevent text size adjustment on orientation change */
        @media screen and (max-device-width: 480px) {
            body {
                -webkit-text-size-adjust: 100%;
                text-size-adjust: 100%;
            }
        }

        /* Safe area insets for modern phones with notches */
        @supports (padding: max(0px)) {
            body {
                padding-left: min(0vmin, env(safe-area-inset-left));
                padding-right: min(0vmin, env(safe-area-inset-right));
            }
            
            header {
                padding-left: max(1rem, env(safe-area-inset-left));
                padding-right: max(1rem, env(safe-area-inset-right));
            }
            
            footer {
                padding-left: max(1rem, env(safe-area-inset-left));
                padding-right: max(1rem, env(safe-area-inset-right));
            }
        }

        /* Improved focus styles for accessibility */
        button:focus-visible,
        .toggle:focus-visible,
        .filter-item:focus-within {
            outline: 2px solid var(--accent);
            outline-offset: 2px;
        }

        /* Smooth scrolling for better mobile experience */
        html {
            scroll-behavior: smooth;
        }
    </style>
</head>

<body>
    <header>
        <div class="toggle" onclick="toggleDarkMode()" role="button" aria-label="Toggle dark mode" tabindex="0">
            <span id="toggleIcon">üåô</span>
            <span id="toggleText">Dark Mode</span>
        </div>
        <h1>üçΩÔ∏è MoodRecipe</h1>
        <p>Find food and restaurants based on your mood</p>
    </header>

    <main>
        <section class="location-section">
            <h2>üìç Location</h2>
            <button onclick="getLocation()" aria-label="Detect my current location">Detect My Location</button>
            <div id="locationStatus" class="status-message">Location not detected yet.</div>
        </section>

        <section>
            <h2>üòä How Are You Feeling?</h2>
            
            <div class="mood-buttons">
                <button onclick="showOptions('happy')" aria-label="Happy mood">
                    <span>üòÑ</span> Happy
                </button>
                <button onclick="showOptions('sad')" aria-label="Sad mood">
                    <span>üò¢</span> Sad
                </button>
                <button onclick="showOptions('tired')" aria-label="Tired mood">
                    <span>üò¥</span> Tired
                </button>
                <button onclick="showOptions('stressed')" aria-label="Stressed mood">
                    <span>üò´</span> Stressed
                </button>
                <button onclick="showOptions('bored')" aria-label="Bored mood">
                    <span>ü•±</span> Bored
                </button>
            </div>

            <div class="filter-section">
                <h3>üö´ Allergen Filters</h3>
                <div class="filter-grid allergen-filters">
                    <label class="filter-item" for="nuts">
                        <input type="checkbox" id="nuts" value="nuts" onchange="applyAllergenFilter()">
                        Nuts üå∞
                    </label>
                    <label class="filter-item" for="milk">
                        <input type="checkbox" id="milk" value="milk" onchange="applyAllergenFilter()">
                        Milk ü•õ
                    </label>
                    <label class="filter-item" for="fish">
                        <input type="checkbox" id="fish" value="fish" onchange="applyAllergenFilter()">
                        Fish üêü
                    </label>
                    <label class="filter-item" for="eggs">
                        <input type="checkbox" id="eggs" value="eggs" onchange="applyAllergenFilter()">
                        Eggs ü•ö
                    </label>
                    <label class="filter-item" for="crustacean">
                        <input type="checkbox" id="crustacean" value="crustacean" onchange="applyAllergenFilter()">
                        Crustacean ü¶ê
                    </label>
                    <label class="filter-item" for="wheat">
                        <input type="checkbox" id="wheat" value="wheat" onchange="applyAllergenFilter()">
                        Wheat üåæ
                    </label>
                    <label class="filter-item" for="gluten">
                        <input type="checkbox" id="gluten" value="gluten" onchange="applyAllergenFilter()">
                        Gluten üåæ
                    </label>
                </div>
            </div>

            <div id="loading" class="loading" style="display:none;" aria-live="polite" aria-busy="true">
                <div class="spinner" aria-hidden="true"></div>
                <p>Finding perfect recipes for you...</p>
            </div>

            <div id="recipeResults" aria-live="polite"></div>
            <button id="moreRecipesBtn" style="display:none; margin-top:1rem; width:100%;" 
                    onclick="showMoreRecipes()" aria-label="Show more recipes">
                ‚ûï Show More Recipes
            </button>

            <div id="restaurantResults" style="margin-top:1.5rem;" aria-live="polite"></div>
        </section>
    </main>

    <footer>
        <p>Powered by Geoapify & OpenStreetMap</p>
    </footer>

    <script>
        // =======================
        // DARK MODE IMPROVEMENTS
        // =======================
        function toggleDarkMode() {
            document.body.classList.toggle("dark");
            const isDark = document.body.classList.contains("dark");
            localStorage.setItem("darkMode", isDark);
            
            // Update toggle text and icon
            document.getElementById('toggleIcon').textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
            document.getElementById('toggleText').textContent = isDark ? 'Light Mode' : 'Dark Mode';
        }

        // Initialize dark mode
        if (localStorage.getItem("darkMode") === "true") {
            document.body.classList.add("dark");
            document.getElementById('toggleIcon').textContent = '‚òÄÔ∏è';
            document.getElementById('toggleText').textContent = 'Light Mode';
        }

        // =======================
        // CONFIG & STATE
        // =======================
        const geoApiKey = "84f2d835ca2048dc86789c4475ede22b";
        let userLat = null, userLon = null;
        let currentMood = null, recipeIndex = 0;
        let shuffledRecipes = [], filteredRecipes = [];
        const RECIPES_PER_LOAD = 3;

        const allergenEmojis = {
            nuts: "üå∞", milk: "ü•õ", fish: "üêü", eggs: "ü•ö",
            crustacean: "ü¶ê", wheat: "üåæ", gluten: "üåæ"
        };
        
        let activeAllergens = [];

        // =======================
        // LOCATION HANDLING WITH LOCALSTORAGE
        // =======================
        function getLocation() {
            const locationStatus = document.getElementById('locationStatus');
            const locationButton = document.querySelector('.location-section button');
            
            if (navigator.geolocation) {
                locationStatus.textContent = "Detecting location...";
                locationStatus.className = "status-message";
                locationButton.disabled = true;
                locationButton.textContent = "Detecting...";
                
                navigator.geolocation.getCurrentPosition(
                    position => {
                        userLat = position.coords.latitude;
                        userLon = position.coords.longitude;
                        
                        // Save to localStorage
                        localStorage.setItem('userLocation', JSON.stringify({
                            lat: userLat,
                            lon: userLon
                        }));
                        
                        locationStatus.textContent = "Location detected successfully! ‚úîÔ∏è";
                        locationStatus.className = "status-message success";
                        locationButton.disabled = false;
                        locationButton.textContent = "Update Location";
                    },
                    error => {
                        let message = "Location permission denied.";
                        if (error.code === error.TIMEOUT) {
                            message = "Location detection timed out.";
                        } else if (error.code === error.POSITION_UNAVAILABLE) {
                            message = "Location information unavailable.";
                        }
                        
                        locationStatus.textContent = message;
                        locationStatus.className = "status-message error";
                        locationButton.disabled = false;
                        locationButton.textContent = "Try Again";
                    },
                    { 
                        timeout: 10000,
                        enableHighAccuracy: true,
                        maximumAge: 60000 
                    }
                );
            } else {
                locationStatus.textContent = "Geolocation is not supported by your browser.";
                locationStatus.className = "status-message error";
            }
        }

        // Load saved location from localStorage
        function loadSavedLocation() {
            const savedLocation = localStorage.getItem('userLocation');
            if (savedLocation) {
                const location = JSON.parse(savedLocation);
                userLat = location.lat;
                userLon = location.lon;
                document.getElementById('locationStatus').textContent = "Using your saved location ‚úîÔ∏è";
                document.getElementById('locationStatus').className = "status-message success";
            }
        }

        // Initialize location on page load
        loadSavedLocation();

        // =======================
        // RECIPE GENERATOR (IMPROVED)
        // =======================
        function generateRecipes(mood) {
            const bases = {
                happy: ["Chicken", "Salmon", "Tofu", "Shrimp", "Veggie"],
                sad: ["Beef", "Chicken", "Cheese", "Pasta", "Potato"],
                tired: ["Egg", "Yogurt", "Oats", "Chicken", "Banana"],
                stressed: ["Rice", "Fish", "Tofu", "Lentils", "Veggies"],
                bored: ["Taco", "Pizza", "Wrap", "Burger", "Pasta"]
            };
            
            const styles = ["Bowl", "Bake", "Grill", "Stir-Fry", "Wrap", "Skillet", "Salad"];
            const flavors = ["Garlic", "Creamy", "Spicy", "Herb", "Lemon", "Classic", "Sweet"];
            
            const allergenMap = {
                Cheese: ["milk"], Yogurt: ["milk"], Egg: ["eggs"],
                Shrimp: ["crustacean", "fish"], Salmon: ["fish"],
                Pasta: ["gluten", "wheat"], Pizza: ["gluten", "milk", "wheat"],
                Wrap: ["gluten", "wheat"], Burger: ["gluten", "wheat"],
                Taco: ["gluten", "wheat"], Oats: ["gluten", "wheat"]
            };

            // Generate unique recipes using Set
            const recipeSet = new Set();
            const recipes = [];
            
            while (recipes.length < 70) {
                const base = bases[mood][Math.floor(Math.random() * bases[mood].length)];
                const style = styles[Math.floor(Math.random() * styles.length)];
                const flavor = flavors[Math.floor(Math.random() * flavors.length)];
                
                const recipeName = `${flavor} ${base} ${style}`;
                
                // Ensure uniqueness
                if (!recipeSet.has(recipeName)) {
                    recipeSet.add(recipeName);
                    recipes.push({
                        name: recipeName,
                        allergens: allergenMap[base] || []
                    });
                }
            }
            
            return recipes;
        }

        // =======================
        // UTILITIES
        // =======================
        function recipeLink(name) {
            return `https://www.google.com/search?q=${encodeURIComponent(name + " recipe")}`;
        }

        function addCard(container, html) {
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = html;
            container.appendChild(card);
        }

        // =======================
        // FILTERING SYSTEM
        // =======================
        function applyAllergenFilter() {
            activeAllergens = [...document.querySelectorAll('.allergen-filters input:checked')]
                .map(input => input.value);
                
            recipeIndex = 0;
            filteredRecipes = shuffledRecipes.filter(recipe => 
                !recipe.allergens.some(allergen => activeAllergens.includes(allergen))
            );
            
            recipeResults.innerHTML = "";
            showRecipes();
        }

        // =======================
        // RECIPE DISPLAY
        // =======================
        function showRecipes() {
            const recipeResults = document.getElementById('recipeResults');
            const moreRecipesBtn = document.getElementById('moreRecipesBtn');
            const list = activeAllergens.length ? filteredRecipes : shuffledRecipes;
            
            if (recipeIndex === 0) {
                const header = document.createElement('h3');
                header.textContent = 'üçΩÔ∏è Recipe Options';
                recipeResults.appendChild(header);
                
                if (list.length === 0) {
                    addCard(recipeResults, "No recipes available with your current allergen filters. Try adjusting your filters.");
                    moreRecipesBtn.style.display = "none";
                    return;
                }
            }
            
            const endIndex = Math.min(recipeIndex + RECIPES_PER_LOAD, list.length);
            const currentRecipes = list.slice(recipeIndex, endIndex);
            
            currentRecipes.forEach(recipe => {
                let allergensHTML = "";
                if (recipe.allergens.length > 0) {
                    allergensHTML = `<div class="allergens" aria-label="Allergens in this recipe">${recipe.allergens.map(allergen => 
                        `<span class="allergen-tag">${allergenEmojis[allergen]} ${allergen}</span>`
                    ).join('')}</div>`;
                }
                
                addCard(recipeResults, `
                    <a href="${recipeLink(recipe.name)}" target="_blank" rel="noopener">${recipe.name}</a>
                    ${allergensHTML}
                `);
            });
            
            recipeIndex = endIndex;
            moreRecipesBtn.style.display = recipeIndex < list.length ? "block" : "none";
            
            // Scroll to recipes if on mobile
            if (window.innerWidth < 768 && recipeIndex > RECIPES_PER_LOAD) {
                recipeResults.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
        }

        function showMoreRecipes() {
            showRecipes();
        }

        // =======================
        // RESTAURANT FINDER (WITH ERROR HANDLING)
        // =======================
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Earth radius in km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = 
                Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(lat1 * Math.PI / 180) * 
                Math.cos(lat2 * Math.PI / 180) * 
                Math.sin(dLon/2) * Math.sin(dLon/2);
                
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            return (R * c).toFixed(2);
        }

        async function showRestaurants() {
            const restaurantResults = document.getElementById('restaurantResults');
            restaurantResults.innerHTML = "";
            
            const header = document.createElement('h3');
            header.textContent = 'üè™ Nearby Restaurants';
            restaurantResults.appendChild(header);
            
            if (!userLat || !userLon) {
                addCard(restaurantResults, "üìç Please enable location services to find nearby restaurants.");
                return;
            }
            
            try {
                const response = await fetch(
                    `https://api.geoapify.com/v2/places?categories=catering.restaurant&filter=circle:${userLon},${userLat},1500&limit=8&apiKey=${geoApiKey}`
                );
                
                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (!data.features || data.features.length === 0) {
                    addCard(restaurantResults, "No restaurants found within 1.5km. Try expanding your search area.");
                    return;
                }
                
                data.features.forEach(place => {
                    if (!place.properties.name) return;
                    
                    const [lon, lat] = place.geometry.coordinates;
                    const distance = calculateDistance(userLat, userLon, lat, lon);
                    
                    addCard(restaurantResults, `
                        <a target="_blank" href="https://www.google.com/maps/search/?api=1&query=${lat},${lon}" rel="noopener">
                            üó∫Ô∏è ${place.properties.name}
                        </a>
                        <div class="allergens">
                            <span class="allergen-tag">üìè ${distance} km away</span>
                        </div>
                    `);
                });
                
            } catch (error) {
                console.error("Restaurant API error:", error);
                addCard(restaurantResults, `
                    ‚ùå Error loading restaurants. Please try again later.
                    <div class="error">${error.message}</div>
                `);
            }
        }

        // =======================
        // MAIN FUNCTIONALITY
        // =======================
        function showOptions(mood) {
            // Disable buttons during loading
            const buttons = document.querySelectorAll('.mood-buttons button');
            buttons.forEach(btn => {
                btn.disabled = true;
                btn.style.opacity = "0.7";
            });
            
            currentMood = mood;
            recipeIndex = 0;
            shuffledRecipes = generateRecipes(mood);
            filteredRecipes = [];
            
            const recipeResults = document.getElementById('recipeResults');
            const restaurantResults = document.getElementById('restaurantResults');
            const loading = document.getElementById('loading');
            const moreRecipesBtn = document.getElementById('moreRecipesBtn');
            
            recipeResults.innerHTML = "";
            restaurantResults.innerHTML = "";
            loading.style.display = "flex";
            moreRecipesBtn.style.display = "none";
            
            // Scroll to loading indicator on mobile
            if (window.innerWidth < 768) {
                loading.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
            
            setTimeout(() => {
                loading.style.display = "none";
                applyAllergenFilter();
                showRestaurants();
                
                // Re-enable buttons
                buttons.forEach(btn => {
                    btn.disabled = false;
                    btn.style.opacity = "1";
                });
                
                // Highlight selected mood
                buttons.forEach(btn => {
                    if (btn.textContent.includes(mood.charAt(0).toUpperCase() + mood.slice(1))) {
                        btn.style.background = "var(--button-hover)";
                        btn.style.color = "white";
                    } else {
                        btn.style.background = "";
                        btn.style.color = "";
                    }
                });
            }, 800);
        }

        // Add touch feedback for better mobile experience
        document.addEventListener('touchstart', function() {}, {passive: true});
    </script>
</body>
</html>
